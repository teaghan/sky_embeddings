2024-08-01 00:37:00,926 - INFO - Note: NumExpr detected 48 cores but "NUMEXPR_MAX_THREADS" not set, so enforcing safe limit of 8.
2024-08-01 00:37:00,926 - INFO - NumExpr defaulting to 8 threads.
2024-08-01 00:37:02,804 - INFO - Rank 0/1: initializing process group..
2024-08-01 00:37:03,372 - INFO - Rank 1/1: distributed training available: True and initialized: True
2024-08-01 00:37:03,372 - INFO - Rank 1/1: world size: 2; rank: 1; local rank: 1
2024-08-01 00:37:03,373 - INFO - Rank 1: CUDA_VISIBLE_DEVICES: 1
2024-08-01 00:37:03,373 - INFO - Rank 1: number of GPUs visible: 1
2024-08-01 00:37:06,011 - INFO - Rank 1/1: initializing models..
2024-08-01 00:37:06,624 - INFO - Rank 1/1: models initialized.
2024-08-01 00:37:06,739 - INFO - Rank 1: initialized train dataloader with 302080 cutouts.
2024-08-01 00:37:06,820 - INFO - Rank 1: initialized validation dataloader with 6400 cutouts.
2024-08-01 00:37:07,936 - INFO - Rank 1 handles indices from 148 to 294
2024-08-01 00:40:34,515 - INFO - Rank 1: performing validation at iteration 500
2024-08-01 00:40:37,445 - INFO - Rank 1: encoding 47 batches...
2024-08-01 00:40:41,697 - INFO - Rank 1: encoding 47 batches...
2024-08-01 00:40:47,959 - INFO - Rank 1: Validation done at iteration 500. Pretraining continues.
2024-08-01 00:44:15,326 - INFO - Rank 1: Iter: 1000; learning rate: 0.00120; wd: 0.04000
2024-08-01 00:44:15,446 - INFO - Rank 1: performing validation at iteration 1000
2024-08-01 00:44:18,355 - INFO - Rank 1: encoding 47 batches...
2024-08-01 00:44:22,475 - INFO - Rank 1: encoding 47 batches...
2024-08-01 00:44:28,731 - INFO - Rank 1: Validation done at iteration 1000. Pretraining continues.
2024-08-01 00:47:11,677 - INFO - Saving checkpoint at iteration 1378. 10.080946222941082 minutes of training since last checkpoint.
2024-08-01 00:47:58,559 - INFO - Rank 1: performing validation at iteration 1500
2024-08-01 00:48:01,674 - INFO - Rank 1: encoding 47 batches...
2024-08-01 00:48:05,921 - INFO - Rank 1: encoding 47 batches...
2024-08-01 00:48:12,790 - INFO - Rank 1: Validation done at iteration 1500. Pretraining continues.
2024-08-01 00:51:50,623 - INFO - Rank 1: Iter: 2000; learning rate: 0.00200; wd: 0.04000
2024-08-01 00:51:50,731 - INFO - Rank 1: performing validation at iteration 2000
2024-08-01 00:51:54,198 - INFO - Rank 1: encoding 47 batches...
2024-08-01 00:51:59,751 - INFO - Rank 1: encoding 47 batches...
2024-08-01 00:52:06,322 - INFO - Rank 1: Validation done at iteration 2000. Pretraining continues.
2024-08-01 01:04:38,660 - INFO - Cleaning up distributed training..
2024-08-01 01:04:38,932 - INFO - Closing H5 file: /localscratch/heesters.32317955.0/HSC_dud_galaxy_GIRYZ7610_64_new.h5
2024-08-01 01:04:38,933 - INFO - Cleaning up shared memory..
masks: 1
2024-08-01 00:37:03,206 - INFO -   num_pred_masks: 6
2024-08-01 00:37:03,206 - INFO -   enc_mask_scale: [0.85, 1.0]
2024-08-01 00:37:03,206 - INFO -   pred_mask_scale: [0.07, 0.1]
2024-08-01 00:37:03,206 - INFO -   max_mask_ratio: 0.9
2024-08-01 00:37:03,206 - INFO -   mask_ratio: 0.75
2024-08-01 00:37:03,206 - INFO - ARCHITECTURE
2024-08-01 00:37:03,206 - INFO -   num_channels: 5
2024-08-01 00:37:03,206 - INFO -   patch_size: 4
2024-08-01 00:37:03,206 - INFO -   model_type: jepa_vit_small
2024-08-01 00:37:03,206 - INFO -   pred_depth: 4
2024-08-01 00:37:03,206 - INFO -   pred_emb_dim: 192
2024-08-01 00:37:03,206 - INFO -   attn_pool: False
2024-08-01 00:37:03,206 - INFO -   ra_dec: True
2024-08-01 00:37:03,206 - INFO -   embed_dim: 1024
2024-08-01 00:37:03,206 - INFO - LOGGING
2024-08-01 00:37:03,206 - INFO -   level: DEBUG
2024-08-01 00:37:03,206 - INFO - Notes
2024-08-01 00:37:03,206 - INFO -   comment: Initial I-JEPA training.
2024-08-01 00:37:05,963 - INFO - Using AdamW
2024-08-01 00:37:05,966 - INFO - Starting fresh model to train...
2024-08-01 00:37:06,010 - INFO - Rank 0/1: initializing models..
2024-08-01 00:37:06,624 - INFO - Rank 0/1: models initialized.
2024-08-01 00:37:06,720 - INFO - Found 295 patches with at least 5 of the ['G', 'I', 'R', 'Y', 'Z'] bands.
2024-08-01 00:37:06,739 - INFO - Rank 0: initialized train dataloader with 302080 cutouts.
2024-08-01 00:37:06,820 - INFO - Rank 0: initialized validation dataloader with 6400 cutouts.
2024-08-01 00:37:06,820 - INFO - Training the network with a batch size of 64 per GPU ...
2024-08-01 00:37:06,820 - INFO - Progress will be displayed every 500 batch iterations and the model will be saved every 10.0 minutes.
2024-08-01 00:37:06,820 - INFO - Starting training loop...
2024-08-01 00:37:07,936 - INFO - Rank 0 handles indices from 0 to 147
2024-08-01 00:37:52,636 - INFO - Iter: 100: avg. loss 0.051515
2024-08-01 00:38:32,108 - INFO - Iter: 200: avg. loss 0.026233
2024-08-01 00:39:11,272 - INFO - Iter: 300: avg. loss 0.017628
2024-08-01 00:39:49,876 - INFO - Iter: 400: avg. loss 0.013311
2024-08-01 00:40:34,405 - INFO - Iter: 500: avg. loss 0.010851
2024-08-01 00:40:34,505 - INFO - Rank 0: performing validation at iteration 500
2024-08-01 00:40:37,445 - INFO - Rank 0: encoding 47 batches...
2024-08-01 00:40:41,693 - INFO - latent_features shape: torch.Size([6000, 256, 384]) in distributed case.
2024-08-01 00:40:42,195 - INFO - Performing classification task on rank 0...
2024-08-01 00:40:44,975 - INFO - Training Accuracy: 0.486, Validation Accuracy: 0.463
2024-08-01 00:40:44,976 - INFO - Training Precision: 0.489, Validation Precision: 0.457
2024-08-01 00:40:44,976 - INFO - Training Recall: 0.486, Validation Recall: 0.463
2024-08-01 00:40:44,976 - INFO - Training F1: 0.479, Validation F1: 0.453
2024-08-01 00:40:44,977 - INFO - Rank 0: encoding 47 batches...
2024-08-01 00:40:47,957 - INFO - latent_features shape: torch.Size([6000, 256, 384]) in distributed case.
2024-08-01 00:40:48,342 - INFO - Performing regression task on rank 0..
2024-08-01 00:40:56,975 - INFO - Training R2: 0.030, Validation R2: -0.017
2024-08-01 00:40:56,976 - INFO - Rank 0: Validation done at iteration 500. Pretraining continues.
2024-08-01 00:40:56,978 - INFO - [iter:   500] [loss: 0.011] [masks: 110.4, 20.8] [wd: 4.00e-02] [lr: 8.00e-04] [mem: 6.18e+03] (117.8 ms)
2024-08-01 00:40:56,978 - INFO - Batch Iterations: 500/1000000
2024-08-01 00:40:56,978 - INFO - Losses:
2024-08-01 00:40:56,978 - INFO - Training Dataset
2024-08-01 00:40:56,978 - INFO -   Total Loss: 0.011
2024-08-01 00:40:56,979 - INFO -   Validation Dataset
2024-08-01 00:40:56,979 - INFO -   Total Loss: 0.008
2024-08-01 00:40:56,979 - INFO - Linear Probing Results:
2024-08-01 00:40:56,979 - INFO - Classification Accuracy:
2024-08-01 00:40:56,979 - INFO -   Training: 0.486, Validation: 0.463
2024-08-01 00:40:56,979 - INFO - Classification Precision:
2024-08-01 00:40:56,979 - INFO -   Training: 0.489, Validation: 0.457
2024-08-01 00:40:56,979 - INFO - Classification Recall:
2024-08-01 00:40:56,979 - INFO -   Training: 0.486, Validation: 0.463
2024-08-01 00:40:56,979 - INFO - Classification F1:
2024-08-01 00:40:56,979 - INFO -   Training: 0.479, Validation: 0.453
2024-08-01 00:40:56,979 - INFO - Regression R2
2024-08-01 00:40:56,979 - INFO -  Training: 0.030, Validation: -0.017
2024-08-01 00:40:56,979 - INFO - iter: [  500] grad_stats: [1.09e-04 3.52e-05] (3.49e-05, 1.42e-04)
2024-08-01 00:41:37,048 - INFO - Iter: 600: avg. loss 0.009293
2024-08-01 00:42:14,535 - INFO - Iter: 700: avg. loss 0.008227
2024-08-01 00:42:52,389 - INFO - Iter: 800: avg. loss 0.007768
2024-08-01 00:43:36,495 - INFO - Iter: 900: avg. loss 0.007256
2024-08-01 00:44:15,325 - INFO - Iter: 1000: avg. loss 0.006751
2024-08-01 00:44:15,327 - INFO - Rank 0: Iter: 1000; learning rate: 0.00120; wd: 0.04000
2024-08-01 00:44:15,436 - INFO - Rank 0: performing validation at iteration 1000
2024-08-01 00:44:18,347 - INFO - Rank 0: encoding 47 batches...
2024-08-01 00:44:22,466 - INFO - latent_features shape: torch.Size([6000, 256, 384]) in distributed case.
2024-08-01 00:44:22,882 - INFO - Performing classification task on rank 0...
2024-08-01 00:44:25,741 - INFO - Training Accuracy: 0.473, Validation Accuracy: 0.465
2024-08-01 00:44:25,741 - INFO - Training Precision: 0.478, Validation Precision: 0.460
2024-08-01 00:44:25,741 - INFO - Training Recall: 0.473, Validation Recall: 0.465
2024-08-01 00:44:25,741 - INFO - Training F1: 0.456, Validation F1: 0.444
2024-08-01 00:44:25,742 - INFO - Rank 0: encoding 47 batches...
2024-08-01 00:44:28,731 - INFO - latent_features shape: torch.Size([6000, 256, 384]) in distributed case.
2024-08-01 00:44:29,115 - INFO - Performing regression task on rank 0..
2024-08-01 00:44:38,554 - INFO - Training R2: 0.021, Validation R2: -0.011
2024-08-01 00:44:38,556 - INFO - Rank 0: Validation done at iteration 1000. Pretraining continues.
2024-08-01 00:44:38,630 - INFO - [iter:  1000] [loss: 0.007] [masks: 110.2, 20.7] [wd: 4.00e-02] [lr: 1.20e-03] [mem: 6.18e+03] (124.7 ms)
2024-08-01 00:44:38,631 - INFO - Batch Iterations: 1000/1000000
2024-08-01 00:44:38,631 - INFO - Losses:
2024-08-01 00:44:38,631 - INFO - Training Dataset
2024-08-01 00:44:38,631 - INFO -   Total Loss: 0.007
2024-08-01 00:44:38,631 - INFO -   Validation Dataset
2024-08-01 00:44:38,631 - INFO -   Total Loss: 0.010
2024-08-01 00:44:38,631 - INFO - Linear Probing Results:
2024-08-01 00:44:38,631 - INFO - Classification Accuracy:
2024-08-01 00:44:38,631 - INFO -   Training: 0.479, Validation: 0.464
2024-08-01 00:44:38,631 - INFO - Classification Precision:
2024-08-01 00:44:38,631 - INFO -   Training: 0.483, Validation: 0.458
2024-08-01 00:44:38,631 - INFO - Classification Recall:
2024-08-01 00:44:38,631 - INFO -   Training: 0.479, Validation: 0.464
2024-08-01 00:44:38,631 - INFO - Classification F1:
2024-08-01 00:44:38,631 - INFO -   Training: 0.467, Validation: 0.448
2024-08-01 00:44:38,631 - INFO - Regression R2
2024-08-01 00:44:38,631 - INFO -  Training: 0.025, Validation: -0.014
2024-08-01 00:44:38,631 - INFO - iter: [ 1000] grad_stats: [5.21e-05 2.64e-05] (4.21e-06, 6.72e-05)
2024-08-01 00:45:18,414 - INFO - Iter: 1100: avg. loss 0.006355
2024-08-01 00:45:58,004 - INFO - Iter: 1200: avg. loss 0.006137
2024-08-01 00:46:38,466 - INFO - Iter: 1300: avg. loss 0.005872
2024-08-01 00:47:11,677 - INFO - Saving checkpoint at iteration 1378. 10.080946830908458 minutes of training since last checkpoint.
2024-08-01 00:47:19,240 - INFO - Iter: 1400: avg. loss 0.005793
2024-08-01 00:47:58,475 - INFO - Iter: 1500: avg. loss 0.006247
2024-08-01 00:47:58,568 - INFO - Rank 0: performing validation at iteration 1500
2024-08-01 00:48:01,674 - INFO - Rank 0: encoding 47 batches...
2024-08-01 00:48:05,918 - INFO - latent_features shape: torch.Size([6000, 256, 384]) in distributed case.
2024-08-01 00:48:07,024 - INFO - Performing classification task on rank 0...
2024-08-01 00:48:09,796 - INFO - Training Accuracy: 0.482, Validation Accuracy: 0.459
2024-08-01 00:48:09,796 - INFO - Training Precision: 0.488, Validation Precision: 0.454
2024-08-01 00:48:09,796 - INFO - Training Recall: 0.482, Validation Recall: 0.459
2024-08-01 00:48:09,796 - INFO - Training F1: 0.465, Validation F1: 0.443
2024-08-01 00:48:09,798 - INFO - Rank 0: encoding 47 batches...
2024-08-01 00:48:12,790 - INFO - latent_features shape: torch.Size([6000, 256, 384]) in distributed case.
2024-08-01 00:48:13,885 - INFO - Performing regression task on rank 0..
2024-08-01 00:48:24,913 - INFO - Training R2: 0.035, Validation R2: -0.018
2024-08-01 00:48:28,564 - INFO - Plotting mask examples..
2024-08-01 00:48:30,351 - INFO - Rank 0: Validation done at iteration 1500. Pretraining continues.
2024-08-01 00:48:30,358 - INFO - [iter:  1500] [loss: 0.006] [masks: 110.1, 20.8] [wd: 4.00e-02] [lr: 1.60e-03] [mem: 6.18e+03] (122.1 ms)
2024-08-01 00:48:30,358 - INFO - Batch Iterations: 1500/1000000
2024-08-01 00:48:30,358 - INFO - Losses:
2024-08-01 00:48:30,358 - INFO - Training Dataset
2024-08-01 00:48:30,358 - INFO -   Total Loss: 0.006
2024-08-01 00:48:30,358 - INFO -   Validation Dataset
2024-08-01 00:48:30,358 - INFO -   Total Loss: 0.049
2024-08-01 00:48:30,358 - INFO - Linear Probing Results:
2024-08-01 00:48:30,358 - INFO - Classification Accuracy:
2024-08-01 00:48:30,358 - INFO -   Training: 0.480, Validation: 0.462
2024-08-01 00:48:30,358 - INFO - Classification Precision:
2024-08-01 00:48:30,358 - INFO -   Training: 0.485, Validation: 0.457
2024-08-01 00:48:30,358 - INFO - Classification Recall:
2024-08-01 00:48:30,358 - INFO -   Training: 0.480, Validation: 0.462
2024-08-01 00:48:30,358 - INFO - Classification F1:
2024-08-01 00:48:30,358 - INFO -   Training: 0.467, Validation: 0.447
2024-08-01 00:48:30,358 - INFO - Regression R2
2024-08-01 00:48:30,359 - INFO -  Training: 0.029, Validation: -0.015
2024-08-01 00:48:30,359 - INFO - iter: [ 1500] grad_stats: [5.10e-08 1.03e-08] (1.03e-08, 1.37e-07)
2024-08-01 00:49:11,218 - INFO - Iter: 1600: avg. loss 0.006856
2024-08-01 00:49:52,544 - INFO - Iter: 1700: avg. loss 0.006459
2024-08-01 00:50:32,310 - INFO - Iter: 1800: avg. loss 0.006103
2024-08-01 00:51:11,458 - INFO - Iter: 1900: avg. loss 0.005783
2024-08-01 00:51:50,622 - INFO - Iter: 2000: avg. loss 0.005495
2024-08-01 00:51:50,623 - INFO - Rank 0: Iter: 2000; learning rate: 0.00200; wd: 0.04000
2024-08-01 00:51:50,731 - INFO - Rank 0: performing validation at iteration 2000
2024-08-01 00:51:54,194 - INFO - Rank 0: encoding 47 batches...
2024-08-01 00:51:59,746 - INFO - latent_features shape: torch.Size([6000, 256, 384]) in distributed case.
2024-08-01 00:52:00,675 - INFO - Performing classification task on rank 0...
2024-08-01 00:52:03,333 - INFO - Training Accuracy: 0.471, Validation Accuracy: 0.468
2024-08-01 00:52:03,333 - INFO - Training Precision: 0.481, Validation Precision: 0.466
2024-08-01 00:52:03,333 - INFO - Training Recall: 0.471, Validation Recall: 0.468
2024-08-01 00:52:03,333 - INFO - Training F1: 0.450, Validation F1: 0.446
2024-08-01 00:52:03,334 - INFO - Rank 0: encoding 47 batches...
2024-08-01 00:52:06,328 - INFO - latent_features shape: torch.Size([6000, 256, 384]) in distributed case.
2024-08-01 00:52:07,230 - INFO - Performing regression task on rank 0..
2024-08-01 00:52:15,448 - INFO - Training R2: 0.022, Validation R2: -0.010
2024-08-01 00:52:16,420 - INFO - Plotting mask examples..
2024-08-01 00:52:17,881 - INFO - Rank 0: Validation done at iteration 2000. Pretraining continues.
2024-08-01 00:52:17,901 - INFO - [iter:  2000] [loss: 0.005] [masks: 110.2, 20.8] [wd: 4.00e-02] [lr: 2.00e-03] [mem: 6.18e+03] (121.9 ms)
2024-08-01 00:52:17,901 - INFO - Batch Iterations: 2000/1000000
2024-08-01 00:52:17,901 - INFO - Losses:
2024-08-01 00:52:17,901 - INFO - Training Dataset
2024-08-01 00:52:17,901 - INFO -   Total Loss: 0.005
2024-08-01 00:52:17,901 - INFO -   Validation Dataset
2024-08-01 00:52:17,901 - INFO -   Total Loss: 0.037
2024-08-01 00:52:17,901 - INFO - Linear Probing Results:
2024-08-01 00:52:17,901 - INFO - Classification Accuracy:
2024-08-01 00:52:17,901 - INFO -   Training: 0.478, Validation: 0.464
2024-08-01 00:52:17,901 - INFO - Classification Precision:
2024-08-01 00:52:17,901 - INFO -   Training: 0.484, Validation: 0.459
2024-08-01 00:52:17,901 - INFO - Classification Recall:
2024-08-01 00:52:17,901 - INFO -   Training: 0.478, Validation: 0.464
2024-08-01 00:52:17,901 - INFO - Classification F1:
2024-08-01 00:52:17,901 - INFO -   Training: 0.462, Validation: 0.446
2024-08-01 00:52:17,901 - INFO - Regression R2
2024-08-01 00:52:17,901 - INFO -  Training: 0.027, Validation: -0.014
2024-08-01 00:52:17,901 - INFO - iter: [ 2000] grad_stats: [2.29e-09 1.79e-09] (1.07e-09, 2.58e-08)
2024-08-01 00:52:56,706 - INFO - Iter: 2100: avg. loss 0.005234
2024-08-01 00:53:38,979 - INFO - Iter: 2200: avg. loss 0.004997
2024-08-01 00:54:17,965 - INFO - Iter: 2300: avg. loss 0.004782
2024-08-01 01:04:43,333 - INFO - Cleaning up distributed training..
2024-08-01 01:04:43,373 - INFO - Closing H5 file: /localscratch/heesters.32317955.0/HSC_dud_galaxy_GIRYZ7610_64_new.h5
2024-08-01 01:04:43,373 - INFO - Cleaning up shared memory..
