2024-08-03 21:30:44,854 - INFO - Note: NumExpr detected 64 cores but "NUMEXPR_MAX_THREADS" not set, so enforcing safe limit of 8.
2024-08-03 21:30:44,854 - INFO - NumExpr defaulting to 8 threads.
2024-08-03 21:31:14,365 - INFO - Distributed training not available, running on single GPU.
2024-08-03 21:31:14,560 - INFO - Using Torch version: 2.3.0 with CUDA version 12.2.
2024-08-03 21:31:14,560 - INFO - Rank 0: CUDA_VISIBLE_DEVICES: 0
2024-08-03 21:31:14,560 - INFO - Rank 0: number of GPUs visible: 1
2024-08-03 21:31:14,586 - INFO - Creating model: jepa_1GPU_test
2024-08-03 21:31:14,586 - INFO - Configuration:
2024-08-03 21:31:14,586 - INFO - DATA
2024-08-03 21:31:14,586 - INFO -   train_data_paths: ['/project/rrg-kyi/astro/hsc/pdr3_dud/']
2024-08-03 21:31:14,586 - INFO -   bands: ['G', 'I', 'R', 'Y', 'Z']
2024-08-03 21:31:14,586 - INFO -   min_bands: 5
2024-08-03 21:31:14,586 - INFO -   cutouts_per_tile: 1024
2024-08-03 21:31:14,586 - INFO -   img_size: 64
2024-08-03 21:31:14,586 - INFO -   val_data_file: HSC_dud_galaxy_GIRYZ7610_64_new.h5
2024-08-03 21:31:14,586 - INFO -   pos_channel: False
2024-08-03 21:31:14,586 - INFO -   lp_class_data_file: HSC_dud_simple_classifier_data_GIRYZ7610_64.h5
2024-08-03 21:31:14,586 - INFO -   lp_regress_data_file: HSC_dud_simple_regressor_data_GIRYZ7610_64.h5
2024-08-03 21:31:14,586 - INFO -   use_calexp: False
2024-08-03 21:31:14,586 - INFO -   pixel_mean: 0.0
2024-08-03 21:31:14,586 - INFO -   pixel_std: 1.0
2024-08-03 21:31:14,586 - INFO -   lp_combine: central
2024-08-03 21:31:14,586 - INFO -   val_batches: 200
2024-08-03 21:31:14,586 - INFO - TRAINING
2024-08-03 21:31:14,586 - INFO -   batch_size: 64
2024-08-03 21:31:14,587 - INFO -   ema: [0.996, 1.0]
2024-08-03 21:31:14,587 - INFO -   total_batch_iters: 1000000.0
2024-08-03 21:31:14,587 - INFO -   warmup_ratio: 2.0e-3
2024-08-03 21:31:14,587 - INFO -   weight_decay: 0.04
2024-08-03 21:31:14,587 - INFO -   final_weight_decay: 0.4
2024-08-03 21:31:14,587 - INFO -   loss_fn: smooth_l1_loss
2024-08-03 21:31:14,587 - INFO -   start_lr: 0.0002
2024-08-03 21:31:14,587 - INFO -   ref_lr: 0.001
2024-08-03 21:31:14,587 - INFO -   final_lr: 1.0e-06
2024-08-03 21:31:14,587 - INFO -   final_lr_factor: 10000000.0
2024-08-03 21:31:14,587 - INFO -   norm_pix_loss: False
2024-08-03 21:31:14,587 - INFO -   use_bfloat16: True
2024-08-03 21:31:14,587 - INFO - MASK
2024-08-03 21:31:14,587 - INFO -   allow_overlap: False
2024-08-03 21:31:14,587 - INFO -   aspect_ratio_targets: [0.75, 1.5]
2024-08-03 21:31:14,587 - INFO -   min_keep: 15
2024-08-03 21:31:14,587 - INFO -   num_enc_masks: 1
2024-08-03 21:31:14,587 - INFO -   num_pred_masks: 6
2024-08-03 21:31:14,587 - INFO -   enc_mask_scale: [0.85, 1.0]
2024-08-03 21:31:14,587 - INFO -   pred_mask_scale: [0.07, 0.1]
2024-08-03 21:31:14,587 - INFO -   max_mask_ratio: 0.9
2024-08-03 21:31:14,587 - INFO -   mask_ratio: 0.75
2024-08-03 21:31:14,587 - INFO - ARCHITECTURE
2024-08-03 21:31:14,587 - INFO -   num_channels: 5
2024-08-03 21:31:14,587 - INFO -   patch_size: 4
2024-08-03 21:31:14,587 - INFO -   model_type: jepa_vit_small
2024-08-03 21:31:14,587 - INFO -   pred_depth: 4
2024-08-03 21:31:14,587 - INFO -   pred_emb_dim: 192
2024-08-03 21:31:14,587 - INFO -   attn_pool: False
2024-08-03 21:31:14,587 - INFO -   ra_dec: True
2024-08-03 21:31:14,587 - INFO -   embed_dim: 1024
2024-08-03 21:31:14,587 - INFO - LOGGING
2024-08-03 21:31:14,587 - INFO -   level: DEBUG
2024-08-03 21:31:14,587 - INFO - Notes
2024-08-03 21:31:14,588 - INFO -   comment: Initial I-JEPA training.
2024-08-03 21:31:17,016 - INFO - Using AdamW
2024-08-03 21:31:17,019 - INFO - Starting fresh model to train...
2024-08-03 21:31:17,131 - INFO - Found 295 patches with at least 5 of the ['G', 'I', 'R', 'Y', 'Z'] bands.
2024-08-03 21:31:17,152 - INFO - Rank 0: initialized train dataloader with 302080 cutouts.
2024-08-03 21:31:17,158 - INFO - Rank 0: initialized validation dataloader with 12800 cutouts.
2024-08-03 21:31:17,158 - INFO - Training the network with a batch size of 64 per GPU ...
2024-08-03 21:31:17,158 - INFO - Progress will be displayed every 100 batch iterations and the model will be saved every 10.0 minutes.
2024-08-03 21:31:17,158 - INFO - Starting training loop...
2024-08-03 21:31:18,518 - INFO - Rank 0 handles indices from 0 to 294
2024-08-03 21:31:56,045 - INFO - Iter: 100: avg. loss 0.087434
2024-08-03 21:31:56,135 - INFO - Rank 0: performing validation at iteration 100
2024-08-03 21:32:07,000 - INFO - Rank 0: encoding 94 batches...
2024-08-03 21:32:14,587 - INFO - len(latent_features): 2
2024-08-03 21:32:14,616 - INFO - latent_features shape: torch.Size([6000, 256, 384]) in non-distributed case.
2024-08-03 21:32:15,131 - INFO - Performing classification task on rank 0...
2024-08-03 21:32:17,706 - INFO - Training Accuracy: 0.834, Validation Accuracy: 0.846
2024-08-03 21:32:17,706 - INFO - Training Precision: 0.840, Validation Precision: 0.848
2024-08-03 21:32:17,706 - INFO - Training Recall: 0.834, Validation Recall: 0.846
2024-08-03 21:32:17,706 - INFO - Training F1: 0.832, Validation F1: 0.844
2024-08-03 21:32:17,707 - INFO - Rank 0: encoding 94 batches...
2024-08-03 21:32:23,344 - INFO - len(latent_features): 2
2024-08-03 21:32:23,345 - INFO - latent_features shape: torch.Size([6000, 256, 384]) in non-distributed case.
2024-08-03 21:32:24,010 - INFO - Performing regression task on rank 0..
2024-08-03 21:32:34,395 - INFO - Training R2: 0.724, Validation R2: 0.709
2024-08-03 21:32:34,396 - INFO - Rank 0: Validation done at iteration 100. Continuing training.
2024-08-03 21:32:34,399 - INFO - [iter:   100] [loss: 0.087] [masks: 109.1, 20.9] [wd: 4.00e-02] [lr: 2.40e-04] [mem: 5.39e+03] (98.3 ms)
2024-08-03 21:32:34,399 - INFO - Batch Iterations: 100/1000000
2024-08-03 21:32:34,399 - INFO - Losses:
2024-08-03 21:32:34,399 - INFO - Training Dataset
2024-08-03 21:32:34,399 - INFO -   Total Loss: 0.087
2024-08-03 21:32:34,399 - INFO -   Validation Dataset
2024-08-03 21:32:34,399 - INFO -   Total Loss: 0.015
2024-08-03 21:32:34,399 - INFO - Linear Probing Results:
2024-08-03 21:32:34,399 - INFO - Classification Accuracy:
2024-08-03 21:32:34,399 - INFO -   Training: 0.834, Validation: 0.846
2024-08-03 21:32:34,399 - INFO - Classification Precision:
2024-08-03 21:32:34,399 - INFO -   Training: 0.840, Validation: 0.848
2024-08-03 21:32:34,399 - INFO - Classification Recall:
2024-08-03 21:32:34,399 - INFO -   Training: 0.834, Validation: 0.846
2024-08-03 21:32:34,399 - INFO - Classification F1:
2024-08-03 21:32:34,399 - INFO -   Training: 0.832, Validation: 0.844
2024-08-03 21:32:34,399 - INFO - Regression R2
2024-08-03 21:32:34,399 - INFO -  Training: 0.724, Validation: 0.709
2024-08-03 21:32:34,399 - INFO - iter: [  100] grad_stats: [8.86e-05 7.77e-05] (5.62e-06, 1.49e-04)
2024-08-03 21:33:07,442 - INFO - Iter: 200: avg. loss 0.044684
2024-08-03 21:33:07,533 - INFO - Rank 0: performing validation at iteration 200
2024-08-03 21:33:18,137 - INFO - Rank 0: encoding 94 batches...
2024-08-03 21:33:25,206 - INFO - len(latent_features): 2
2024-08-03 21:33:25,207 - INFO - latent_features shape: torch.Size([6000, 256, 384]) in non-distributed case.
2024-08-03 21:33:25,776 - INFO - Performing classification task on rank 0...
2024-08-03 21:33:28,256 - INFO - Training Accuracy: 0.823, Validation Accuracy: 0.840
2024-08-03 21:33:28,256 - INFO - Training Precision: 0.831, Validation Precision: 0.843
2024-08-03 21:33:28,256 - INFO - Training Recall: 0.823, Validation Recall: 0.840
2024-08-03 21:33:28,256 - INFO - Training F1: 0.821, Validation F1: 0.838
2024-08-03 21:33:28,257 - INFO - Rank 0: encoding 94 batches...
2024-08-03 21:33:33,918 - INFO - len(latent_features): 2
2024-08-03 21:33:33,918 - INFO - latent_features shape: torch.Size([6000, 256, 384]) in non-distributed case.
2024-08-03 21:33:34,582 - INFO - Performing regression task on rank 0..
2024-08-03 21:33:45,543 - INFO - Training R2: 0.702, Validation R2: 0.691
2024-08-03 21:33:45,545 - INFO - Rank 0: Validation done at iteration 200. Continuing training.
2024-08-03 21:33:45,547 - INFO - [iter:   200] [loss: 0.044] [masks: 109.3, 20.9] [wd: 4.00e-02] [lr: 2.80e-04] [mem: 5.39e+03] (93.0 ms)
2024-08-03 21:33:45,548 - INFO - Batch Iterations: 200/1000000
2024-08-03 21:33:45,548 - INFO - Losses:
2024-08-03 21:33:45,548 - INFO - Training Dataset
2024-08-03 21:33:45,548 - INFO -   Total Loss: 0.044
2024-08-03 21:33:45,548 - INFO -   Validation Dataset
2024-08-03 21:33:45,548 - INFO -   Total Loss: 0.011
2024-08-03 21:33:45,548 - INFO - Linear Probing Results:
2024-08-03 21:33:45,548 - INFO - Classification Accuracy:
2024-08-03 21:33:45,548 - INFO -   Training: 0.828, Validation: 0.843
2024-08-03 21:33:45,548 - INFO - Classification Precision:
2024-08-03 21:33:45,548 - INFO -   Training: 0.835, Validation: 0.846
2024-08-03 21:33:45,548 - INFO - Classification Recall:
2024-08-03 21:33:45,548 - INFO -   Training: 0.828, Validation: 0.843
2024-08-03 21:33:45,548 - INFO - Classification F1:
2024-08-03 21:33:45,548 - INFO -   Training: 0.827, Validation: 0.841
2024-08-03 21:33:45,548 - INFO - Regression R2
2024-08-03 21:33:45,548 - INFO -  Training: 0.713, Validation: 0.700
2024-08-03 21:33:45,548 - INFO - iter: [  200] grad_stats: [2.26e-05 1.72e-05] (7.55e-07, 3.64e-05)
2024-08-03 21:34:22,536 - INFO - Iter: 300: avg. loss 0.030052
2024-08-03 21:34:22,626 - INFO - Rank 0: performing validation at iteration 300
2024-08-03 21:34:33,195 - INFO - Rank 0: encoding 94 batches...
2024-08-03 21:34:40,703 - INFO - len(latent_features): 2
2024-08-03 21:34:40,704 - INFO - latent_features shape: torch.Size([6000, 256, 384]) in non-distributed case.
2024-08-03 21:34:41,193 - INFO - Performing classification task on rank 0...
2024-08-03 21:34:43,771 - INFO - Training Accuracy: 0.813, Validation Accuracy: 0.840
2024-08-03 21:34:43,771 - INFO - Training Precision: 0.821, Validation Precision: 0.843
2024-08-03 21:34:43,771 - INFO - Training Recall: 0.813, Validation Recall: 0.840
2024-08-03 21:34:43,771 - INFO - Training F1: 0.811, Validation F1: 0.838
2024-08-03 21:34:43,772 - INFO - Rank 0: encoding 94 batches...
2024-08-03 21:34:49,437 - INFO - len(latent_features): 2
2024-08-03 21:34:49,438 - INFO - latent_features shape: torch.Size([6000, 256, 384]) in non-distributed case.
2024-08-03 21:34:50,103 - INFO - Performing regression task on rank 0..
2024-08-03 21:35:00,402 - INFO - Training R2: 0.694, Validation R2: 0.682
2024-08-03 21:35:01,821 - INFO - Plotting mask examples..
2024-08-03 21:35:03,526 - INFO - Rank 0: Validation done at iteration 300. Continuing training.
2024-08-03 21:35:03,549 - INFO - [iter:   300] [loss: 0.030] [masks: 110.3, 20.7] [wd: 4.00e-02] [lr: 3.20e-04] [mem: 5.45e+03] (91.6 ms)
2024-08-03 21:35:03,550 - INFO - Batch Iterations: 300/1000000
2024-08-03 21:35:03,550 - INFO - Losses:
2024-08-03 21:35:03,550 - INFO - Training Dataset
2024-08-03 21:35:03,550 - INFO -   Total Loss: 0.030
2024-08-03 21:35:03,550 - INFO -   Validation Dataset
2024-08-03 21:35:03,550 - INFO -   Total Loss: 0.009
2024-08-03 21:35:03,550 - INFO - Linear Probing Results:
2024-08-03 21:35:03,550 - INFO - Classification Accuracy:
2024-08-03 21:35:03,550 - INFO -   Training: 0.823, Validation: 0.842
2024-08-03 21:35:03,550 - INFO - Classification Precision:
2024-08-03 21:35:03,550 - INFO -   Training: 0.831, Validation: 0.845
2024-08-03 21:35:03,550 - INFO - Classification Recall:
2024-08-03 21:35:03,550 - INFO -   Training: 0.823, Validation: 0.842
2024-08-03 21:35:03,550 - INFO - Classification F1:
2024-08-03 21:35:03,550 - INFO -   Training: 0.821, Validation: 0.840
2024-08-03 21:35:03,550 - INFO - Regression R2
2024-08-03 21:35:03,550 - INFO -  Training: 0.707, Validation: 0.694
2024-08-03 21:35:03,550 - INFO - iter: [  300] grad_stats: [1.13e-04 7.77e-05] (2.24e-05, 1.76e-04)
2024-08-03 21:35:39,564 - INFO - Iter: 400: avg. loss 0.022715
2024-08-03 21:35:39,651 - INFO - Rank 0: performing validation at iteration 400
2024-08-03 21:35:51,628 - INFO - Rank 0: encoding 94 batches...
2024-08-03 21:35:58,706 - INFO - len(latent_features): 2
2024-08-03 21:35:58,706 - INFO - latent_features shape: torch.Size([6000, 256, 384]) in non-distributed case.
2024-08-03 21:35:59,327 - INFO - Performing classification task on rank 0...
2024-08-03 21:36:02,002 - INFO - Training Accuracy: 0.812, Validation Accuracy: 0.832
2024-08-03 21:36:02,002 - INFO - Training Precision: 0.819, Validation Precision: 0.834
2024-08-03 21:36:02,002 - INFO - Training Recall: 0.812, Validation Recall: 0.832
2024-08-03 21:36:02,002 - INFO - Training F1: 0.810, Validation F1: 0.830
2024-08-03 21:36:02,004 - INFO - Rank 0: encoding 94 batches...
2024-08-03 21:36:07,627 - INFO - len(latent_features): 2
2024-08-03 21:36:07,628 - INFO - latent_features shape: torch.Size([6000, 256, 384]) in non-distributed case.
2024-08-03 21:36:08,300 - INFO - Performing regression task on rank 0..
2024-08-03 21:36:19,073 - INFO - Training R2: 0.700, Validation R2: 0.679
2024-08-03 21:36:19,761 - INFO - Plotting mask examples..
2024-08-03 21:36:21,118 - INFO - Rank 0: Validation done at iteration 400. Continuing training.
2024-08-03 21:36:21,121 - INFO - [iter:   400] [loss: 0.023] [masks: 110.1, 20.8] [wd: 4.00e-02] [lr: 3.60e-04] [mem: 5.64e+03] (90.5 ms)
2024-08-03 21:36:21,121 - INFO - Batch Iterations: 400/1000000
2024-08-03 21:36:21,121 - INFO - Losses:
2024-08-03 21:36:21,121 - INFO - Training Dataset
2024-08-03 21:36:21,121 - INFO -   Total Loss: 0.023
2024-08-03 21:36:21,121 - INFO -   Validation Dataset
2024-08-03 21:36:21,121 - INFO -   Total Loss: 0.008
2024-08-03 21:36:21,121 - INFO - Linear Probing Results:
2024-08-03 21:36:21,121 - INFO - Classification Accuracy:
2024-08-03 21:36:21,121 - INFO -   Training: 0.821, Validation: 0.839
2024-08-03 21:36:21,121 - INFO - Classification Precision:
2024-08-03 21:36:21,121 - INFO -   Training: 0.828, Validation: 0.842
2024-08-03 21:36:21,121 - INFO - Classification Recall:
2024-08-03 21:36:21,121 - INFO -   Training: 0.821, Validation: 0.839
2024-08-03 21:36:21,121 - INFO - Classification F1:
2024-08-03 21:36:21,121 - INFO -   Training: 0.819, Validation: 0.837
2024-08-03 21:36:21,121 - INFO - Regression R2
2024-08-03 21:36:21,121 - INFO -  Training: 0.705, Validation: 0.690
2024-08-03 21:36:21,121 - INFO - iter: [  400] grad_stats: [1.39e-05 3.44e-06] (8.35e-07, 1.51e-05)
2024-08-03 21:36:55,230 - INFO - Iter: 500: avg. loss 0.018467
2024-08-03 21:36:55,312 - INFO - Rank 0: performing validation at iteration 500
2024-08-03 21:37:05,835 - INFO - Rank 0: encoding 94 batches...
2024-08-03 21:37:12,786 - INFO - len(latent_features): 2
2024-08-03 21:37:12,786 - INFO - latent_features shape: torch.Size([6000, 256, 384]) in non-distributed case.
2024-08-03 21:37:13,393 - INFO - Performing classification task on rank 0...
2024-08-03 21:37:16,081 - INFO - Training Accuracy: 0.807, Validation Accuracy: 0.828
2024-08-03 21:37:16,082 - INFO - Training Precision: 0.813, Validation Precision: 0.830
2024-08-03 21:37:16,082 - INFO - Training Recall: 0.807, Validation Recall: 0.828
2024-08-03 21:37:16,082 - INFO - Training F1: 0.804, Validation F1: 0.825
2024-08-03 21:37:16,083 - INFO - Rank 0: encoding 94 batches...
2024-08-03 21:37:21,707 - INFO - len(latent_features): 2
2024-08-03 21:37:21,707 - INFO - latent_features shape: torch.Size([6000, 256, 384]) in non-distributed case.
2024-08-03 21:37:22,371 - INFO - Performing regression task on rank 0..
2024-08-03 21:37:32,470 - INFO - Training R2: 0.681, Validation R2: 0.673
2024-08-03 21:37:32,889 - INFO - Plotting mask examples..
2024-08-03 21:37:34,250 - INFO - Rank 0: Validation done at iteration 500. Continuing training.
2024-08-03 21:37:34,261 - INFO - [iter:   500] [loss: 0.018] [masks: 110.1, 20.7] [wd: 4.00e-02] [lr: 4.00e-04] [mem: 5.64e+03] (90.0 ms)
2024-08-03 21:37:34,261 - INFO - Batch Iterations: 500/1000000
2024-08-03 21:37:34,261 - INFO - Losses:
2024-08-03 21:37:34,261 - INFO - Training Dataset
2024-08-03 21:37:34,261 - INFO -   Total Loss: 0.018
2024-08-03 21:37:34,261 - INFO -   Validation Dataset
2024-08-03 21:37:34,261 - INFO -   Total Loss: 0.009
2024-08-03 21:37:34,261 - INFO - Linear Probing Results:
2024-08-03 21:37:34,261 - INFO - Classification Accuracy:
2024-08-03 21:37:34,261 - INFO -   Training: 0.818, Validation: 0.837
2024-08-03 21:37:34,261 - INFO - Classification Precision:
2024-08-03 21:37:34,261 - INFO -   Training: 0.825, Validation: 0.840
2024-08-03 21:37:34,261 - INFO - Classification Recall:
2024-08-03 21:37:34,262 - INFO -   Training: 0.818, Validation: 0.837
2024-08-03 21:37:34,262 - INFO - Classification F1:
2024-08-03 21:37:34,262 - INFO -   Training: 0.816, Validation: 0.835
2024-08-03 21:37:34,262 - INFO - Regression R2
2024-08-03 21:37:34,262 - INFO -  Training: 0.700, Validation: 0.687
2024-08-03 21:37:34,262 - INFO - iter: [  500] grad_stats: [8.37e-05 2.54e-05] (3.15e-06, 1.18e-04)
